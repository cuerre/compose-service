# CONFIGS APPLIED GLOBALLY
global
    maxconn 32768
    daemon

# CONFIGS APPLIED BY DEFAULT ON FRONTENDS AND BACKENDS
defaults
    mode    http
    retries 3
    timeout connect     5s
    timeout client     50s
    timeout server    450s

# FRONTENDS HTTP
frontend http-in
    bind *:80

    acl http ssl_fc,not
    http-request redirect scheme https if http

# FRONTENDS HTTP
frontend https-in
    bind *:443
    mode http

    acl host_cuerre hdr(host) -i cuerre.com
    use_backend cluster_cuerre if host_cuerre

    acl host_manage_cuerre hdr(host) -i manage.cuerre.com
    use_backend cluster_manage_cuerre if host_manage_cuerre


# BACKENDS HTTP
backend cluster_cuerre
    mode http
    balance roundrobin
    option forwardfor
    server application frontend:8010 check

# BACKENDS MANAGE
backend cluster_manage_cuerre
    mode http
    balance roundrobin
    option forwardfor
    server adminer adminer:8020 check
