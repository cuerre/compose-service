version: "3.5"



#Docker Networks
networks:
    internal:
        driver: bridge
        name: internal
    external:
        driver: bridge
        name: external
    


# Docker Volumes
volumes:
    backend:
        name: backend



# Docker services     
services:

    # Web Service (backend)
    backend:
        image: registry.gitlab.com/achetronic/cuerre:latest
        container_name: backend
        restart: always
        tty: true
        stdin_open: true
        environment:
            APP_VENDOR: "ALKE Systems"
            APP_NAME: "Cuerre"
            APP_ENV: local
            APP_KEY: "base64:ejHnK9FbRXrtLw85zkQ9Eo7DiyQyJfVSge20qX+rQ8s="
            APP_DEBUG: "false"
            APP_URL: http://cuerre.com
            LOG_CHANNEL: stack
            ###### MYSQL ######
            DB_CONNECTION: mysql
            DB_HOST: "161.35.201.58"
            DB_PORT: 3306
            DB_DATABASE: "cuerre"
            DB_USERNAME: "user"
            DB_PASSWORD: "Cuerre#2020"
            ###### REDIS ######
            BROADCAST_DRIVER: log
            CACHE_DRIVER: redis
            QUEUE_CONNECTION: sync
            SESSION_DRIVER: redis
            SESSION_LIFETIME: 120
            REDIS_HOST: "161.35.201.58"
            REDIS_PASSWORD: null
            REDIS_PORT: 6379
            ###### SENDGRID ######
            MAIL_DRIVER: smtp
            MAIL_HOST: smtp.sendgrid.net
            MAIL_PORT: 587
            MAIL_USERNAME: apikey
            MAIL_PASSWORD: "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"
            MAIL_ENCRYPTION: tls
            MAIL_FROM_NAME: "${APP_NAME}"
            MAIL_FROM_ADDRESS: "noreply@cuerre.com"
            ###### Paypal LIVE ######
            PAYPAL_MODE: "live"
            PAYPAL_LIVE_API_USERNAME : "donfumero_api1.gmail.com"
            PAYPAL_LIVE_API_PASSWORD : "U95B7P7R3ZJQQ9VN"
            PAYPAL_LIVE_API_SECRET : "AIsNObN1SyNNjqJjWf1oEu4qD6WYAL1fjpeTpCyPJ5BKrMenA2W3.Yp."
            #PAYPAL_LIVE_API_CERTIFICATE=""
            ###### Paypal SANDBOX ######
            #PAYPAL_SANDBOX_API_USERNAME="sb-ti1lf1640123_api1.business.example.com"
            #PAYPAL_SANDBOX_API_PASSWORD="S5AASPTS4LDW22DH"
            #PAYPAL_SANDBOX_API_SECRET="AhA5ldNZQQWNMXmU4HmK-tRXVgZVAegh0I.9D.JPtgQWal70fb2xGnJD"
            # PAYPAL_SANDBOX_API_CERTIFICATE=""

        working_dir: /var/www
        volumes:
            - type: volume
              source: backend
              target: /var/www
        expose: 
            - "9000"
        networks: 
            - internal

    # Web Service (frontend)
    frontend:
        build:
            context: ./build/frontend
            dockerfile: Dockerfile
        image: frontend:nginx
        container_name: frontend
        depends_on:
            - backend
        restart: always
        tty: true
        stdin_open: true
        working_dir: /var/www
        volumes:
            - type: volume
              source: backend
              target: /var/www
              volume:
                nocopy: true
                read_only: true
        ports:
            - "80:80"
            - "443:443"
        networks:
            - internal
            - external

